<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Google Sheet Dashboard</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 40px;
    background-color: #f4f6f8;
    color: #333;
  }

  h2 {
    color: #222;
    margin-bottom: 16px;
  }

  input[type="text"] {
    padding: 10px 14px;
    width: 300px;
    font-size: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-bottom: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }

  th, td {
    padding: 12px 14px;
    border-bottom: 1px solid #eee;
    text-align: left;
  }

  th {
    background-color: #f0f2f5;
    color: #555;
    font-weight: 600;
  }

  tr:hover {
    background-color: #fafafa;
  }

  .edit-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 16px;
    color: #007bff;
  }

  .edit-btn:hover {
    color: #0056b3;
  }

  .form-container {
    margin-top: 30px;
    padding: 20px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  }

  .form-container input {
    display: block;
    width: 100%;
    margin-bottom: 14px;
    padding: 10px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  .save-btn {
    background: #28a745;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    font-size: 15px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .save-btn:hover {
    background: #218838;
  }
</style>

</head>
<body>

  <h2>Dashboard Google Sheet</h2>
  <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm..." />
  <table id="dataTable">
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
  </table>

  <div id="formContainer" class="form-container" style="display:none;"></div>

  <script>
    const url = 'https://lzdcemanagement.phuonghoangcao1703.workers.dev/';
    let originalData = [];

    fetch(url)
  .then(r => r.json())
  .then(data => {
    console.log('üì¶ Data nh·∫≠n ƒë∆∞·ª£c:', data);      // Ki·ªÉm tra tr√™n Console
    if (Array.isArray(data)) {
      originalData = data;
      renderTable(data);
    } else {
      document.body.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
    }
  })
  .catch(err => {
    console.error('‚ùå L·ªói fetch:', err);
    document.body.innerHTML = '<p style="color:red">Kh√¥ng th·ªÉ load d·ªØ li·ªáu: ' + err + '</p>';
  });


    function renderTable(data) {
      const thead = document.getElementById('thead');
      const tbody = document.getElementById('tbody');
      thead.innerHTML = tbody.innerHTML = '';

      if (!data.length) return;

      const keys = Object.keys(data[0]).filter(k => k !== '_row');
      const trHead = document.createElement('tr');
      keys.forEach(k => {
        const th = document.createElement('th');
        th.textContent = k;
        trHead.appendChild(th);
      });
      const thAct = document.createElement('th'); thAct.textContent = '‚úé';
      trHead.appendChild(thAct); thead.appendChild(trHead);

      data.forEach(item => {
        const tr = document.createElement('tr');
        keys.forEach(k => {
          const td = document.createElement('td');
          td.textContent = item[k]; tr.appendChild(td);
        });
        const tdBtn = document.createElement('td');
        const btn = document.createElement('button');
        btn.className = 'edit-btn'; btn.textContent = '‚úé';
        btn.onclick = () => showEditForm(item);
        tdBtn.appendChild(btn); tr.appendChild(tdBtn);
        tbody.appendChild(tr);
      });
    }

    function showEditForm(item) {
      const container = document.getElementById('formContainer');
      container.style.display = 'block'; container.innerHTML = '';
      const form = document.createElement('div');
      const keys = Object.keys(item).filter(k => k !== '_row');

      keys.forEach(k => {
        const input = document.createElement('input');
        input.dataset.key = k; input.value = item[k]; form.appendChild(input);
      });

      const save = document.createElement('button');
      save.className = 'save-btn'; save.textContent = 'L∆∞u';
      save.onclick = () => {
        const inputs = form.querySelectorAll('input');
        const payload = { _row: item._row };
        inputs.forEach(i => payload[i.dataset.key] = i.value);

        fetch(url, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body:JSON.stringify(payload)
        })
        .then(r => r.text())
        .then(msg => {
          alert(msg);
          return fetch(url).then(r => r.json()).then(d => {
            originalData = d; renderTable(d); container.style.display='none';
          });
        })
        .catch(err => alert('L·ªói g·ª≠i d·ªØ li·ªáu: ' + err));
      };

      form.appendChild(save); container.appendChild(form);
    }

    document.getElementById('searchInput').addEventListener('input', e => {
      const kw = e.target.value.toLowerCase();
      renderTable(originalData.filter(o =>
        Object.values(o).some(v =>
          typeof v === 'string' && v.toLowerCase().includes(kw)
        )
      ));
    });
  </script>

</body>
</html>


