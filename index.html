<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Google Sheet Dashboard</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 30px; background:#f8f9fa; }
    input[type="text"] { padding:8px; width:300px; font-size:16px; margin-bottom:20px; }
    table { width:100%; border-collapse:collapse; margin-bottom:30px; }
    th,td { border:1px solid #ddd; padding:10px; }
    th { background:#e9ecef; text-align:left; }
    .edit-btn { background:#007bff; color:#fff; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; }
    .form-container { background:#fff; border:1px solid #ccc; padding:20px; margin-top:-10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    .form-container input { display:block; width:100%; margin-bottom:12px; padding:8px; font-size:15px; }
    .save-btn { background:#28a745; color:#fff; border:none; padding:8px 16px; border-radius:4px; font-size:16px; cursor:pointer; }
  </style>
</head>
<body>

  <h2>Dashboard Google Sheet</h2>
  <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm..." />
  <table id="dataTable">
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
  </table>

  <div id="formContainer" class="form-container" style="display:none;"></div>

  <script>
    const url = 'https://lzdcemanagement.phuonghoangcao1703.workers.dev/';
    let originalData = [];

    fetch(url)
  .then(r => r.json())
  .then(data => {
    console.log('üì¶ Data nh·∫≠n ƒë∆∞·ª£c:', data);      // Ki·ªÉm tra tr√™n Console
    if (Array.isArray(data)) {
      originalData = data;
      renderTable(data);
    } else {
      document.body.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
    }
  })
  .catch(err => {
    console.error('‚ùå L·ªói fetch:', err);
    document.body.innerHTML = '<p style="color:red">Kh√¥ng th·ªÉ load d·ªØ li·ªáu: ' + err + '</p>';
  });


    function renderTable(data) {
      const thead = document.getElementById('thead');
      const tbody = document.getElementById('tbody');
      thead.innerHTML = tbody.innerHTML = '';

      if (!data.length) return;

      const keys = Object.keys(data[0]).filter(k => k !== '_row');
      const trHead = document.createElement('tr');
      keys.forEach(k => {
        const th = document.createElement('th');
        th.textContent = k;
        trHead.appendChild(th);
      });
      const thAct = document.createElement('th'); thAct.textContent = '‚úé';
      trHead.appendChild(thAct); thead.appendChild(trHead);

      data.forEach(item => {
        const tr = document.createElement('tr');
        keys.forEach(k => {
          const td = document.createElement('td');
          td.textContent = item[k]; tr.appendChild(td);
        });
        const tdBtn = document.createElement('td');
        const btn = document.createElement('button');
        btn.className = 'edit-btn'; btn.textContent = '‚úé';
        btn.onclick = () => showEditForm(item);
        tdBtn.appendChild(btn); tr.appendChild(tdBtn);
        tbody.appendChild(tr);
      });
    }

    function showEditForm(item) {
      const container = document.getElementById('formContainer');
      container.style.display = 'block'; container.innerHTML = '';
      const form = document.createElement('div');
      const keys = Object.keys(item).filter(k => k !== '_row');

      keys.forEach(k => {
        const input = document.createElement('input');
        input.dataset.key = k; input.value = item[k]; form.appendChild(input);
      });

      const save = document.createElement('button');
      save.className = 'save-btn'; save.textContent = 'L∆∞u';
      save.onclick = () => {
        const inputs = form.querySelectorAll('input');
        const payload = { _row: item._row };
        inputs.forEach(i => payload[i.dataset.key] = i.value);

        fetch(url, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body:JSON.stringify(payload)
        })
        .then(r => r.text())
        .then(msg => {
          alert(msg);
          return fetch(url).then(r => r.json()).then(d => {
            originalData = d; renderTable(d); container.style.display='none';
          });
        })
        .catch(err => alert('L·ªói g·ª≠i d·ªØ li·ªáu: ' + err));
      };

      form.appendChild(save); container.appendChild(form);
    }

    document.getElementById('searchInput').addEventListener('input', e => {
      const kw = e.target.value.toLowerCase();
      renderTable(originalData.filter(o =>
        Object.values(o).some(v =>
          typeof v === 'string' && v.toLowerCase().includes(kw)
        )
      ));
    });
  </script>

</body>
</html>

