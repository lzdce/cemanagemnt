<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Google Sheet Editor</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background-color: #f2f2f2; }
    input[type="text"] { width: 100%; }
    .save-btn { padding: 5px 10px; background: #28a745; color: white; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Google Sheet Editor</h2>
  <div id="table-container">Loading...</div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbw1EaV4eggT8ZB247wkTWeSDGzu5NI8jtgtzmEZLEwuRUA6iwGW2u69JHzv4a7xtjh9Uw/exec";

    fetch(API_URL)
      .then(res => res.json())
      .then(data => renderTable(data));

    function renderTable(data) {
      if (!data.length) return document.getElementById("table-container").innerText = "No data found.";

      const headers = Object.keys(data[0]).filter(key => key !== "_row");
      const table = document.createElement("table");

      const thead = table.createTHead();
      const headRow = thead.insertRow();
      headers.forEach(h => {
        const th = document.createElement("th");
        th.innerText = h;
        headRow.appendChild(th);
      });
      const th = document.createElement("th");
      th.innerText = "Action";
      headRow.appendChild(th);

      const tbody = table.createTBody();
      data.forEach(row => {
        const tr = tbody.insertRow();
        headers.forEach(h => {
          const td = tr.insertCell();
          const input = document.createElement("input");
          input.type = "text";
          input.value = row[h];
          input.dataset.field = h;
          td.appendChild(input);
        });

        const td = tr.insertCell();
        const btn = document.createElement("button");
        btn.className = "save-btn";
        btn.innerText = "Save";
        btn.onclick = () => saveRow(tr, row._row);
        td.appendChild(btn);
      });

      document.getElementById("table-container").innerHTML = "";
      document.getElementById("table-container").appendChild(table);
    }

    function saveRow(rowElement, rowNumber) {
      const inputs = rowElement.querySelectorAll("input");
      const payload = { _row: rowNumber };
      inputs.forEach(input => {
        payload[input.dataset.field] = input.value;
      });

      console.log("Sending payload:", payload); // Log kiá»ƒm tra

      fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(payload),
        headers: { "Content-Type": "application/json" }
      })
        .then(res => res.text())
        .then(msg => alert(msg))
        .catch(err => alert("Error: " + err));
    }
  </script>
</body>
</html>
